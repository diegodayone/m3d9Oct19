<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    ​
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <style>

      .list-group-item{
        display: flex;
      flex-direction: row;
      justify-content: space-between;
      }
   
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Welcome to the backoffice!</h1>
      <h2>Create all the events that you like</h2>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <form onsubmit="handleSubmit()">
            <div class="form-group">
              <label for="name">Event Name</label>
              <input
                type="text"
                class="form-control"
                id="name"
                placeholder="insert the name right here"
                required
              />
            </div>

            <div class="form-group">
              <label for="description">Event Description</label>
              <textarea
                class="form-control"
                id="description"
                rows="3"
                required
              ></textarea>
            </div>

            <div class="form-group">
              <label for="price">Event Price</label>
              <input type="number" class="form-control" id="price" required />
            </div>

            <div class="form-group">
              <label for="time">Event Date-Time</label>
              <input
                type="datetime-local"
                class="form-control"
                id="time"
                required
              />
            </div>

            <div class="form-group">
              <input
                type="submit"
                class="btn btn-primary"
                value="Submit event"
              />
            </div>
          </form>
        </div>
        <div class="col-md-6">
          <div id="eventsColumn"></div>
        </div>
      </div>
    </div>

    ​
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    ​
    <script src="helper.js"></script>

    <script>
      window.onload = async () => {
        const events = await getEvents();
        console.log("events", events);
        const eventsColumn = document.querySelector("#eventsColumn");

        if (events.length > 0) {
          eventsColumn.innerHTML = "<ul class='list-group'>" + events  //we show events
            .map(
              event => `
                <li class="list-group-item"> 
                    <div>${event.time} - ${event.name} </div>
                    <div>
                        <a href="details.html?id=${event._id}"> Details </a>
                        <input type="button" class="btn btn-danger" value="X" onclick="deleteRow('${event._id}')" />
                    </div>
                </li>
                `
            )
            .join("") + " </ul>";
        } else {
          currentEventsDiv.innerText = "Create events to see them here!";
        }
      };

      deleteRow = async (id) => {
        //1) try to use the deletEvent method to delete the element
        //2) if successful, remove the element from the DOM
        var button = event.currentTarget;
        var parent = button.parentElement.parentElement.parentElement.removeChild(button.parentElement.parentElement);

        await deleteEvent(id);
      }

      handleSubmit = async () => {
        event.preventDefault(); //preventing the default browser event handling
        const myEvent = {
          //gathering the data from the form, field by field
          name: document.querySelector("#name").value,
          description: document.querySelector("#description").value,
          time: document.querySelector("#time").value,
          price: document.querySelector("#price").value
        };
        console.log("myEvent", JSON.stringify(myEvent));

        const response = await saveEvent(myEvent); //saving in the response variable the result of the POST

        if (response.ok) {
          //checking the ok property which stores the successfull result of the operation
          alert("the event was saved successfully");
        } else {
          alert("the event was NOT saved successfully");
        }
      };
    </script>
  </body>
</html>
